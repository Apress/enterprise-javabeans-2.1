<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE ejb-jar PUBLIC "-//Sun Microsystems, Inc.//DTD Enterprise JavaBeans 2.0//EN" "http://java.sun.com/dtd/ejb-jar_2_0.dtd">
<ejb-jar>
    <enterprise-beans>
        <entity>
            <ejb-name>Store</ejb-name>
            <home>ejb.store.StoreHome</home>
            <remote>ejb.store.Store</remote>
            <ejb-class>ejb.store.StoreBean</ejb-class>
            <persistence-type>Container</persistence-type>
            <prim-key-class>java.lang.Integer</prim-key-class>
            <reentrant>False</reentrant>
            <cmp-version>2.x</cmp-version>
            <abstract-schema-name>Store</abstract-schema-name>
            <cmp-field>
              <field-name>id</field-name>
            </cmp-field>
            <cmp-field>
              <field-name>name</field-name>
            </cmp-field>
            <primkey-field>id</primkey-field>
            <query>
              <query-method>
                <method-name>findAllStores</method-name>
                <method-params>
                </method-params>
              </query-method>
              <ejb-ql>
                SELECT OBJECT(s) FROM Store AS s
              </ejb-ql>
            </query>
            <query>
              <query-method>
                <method-name>ejbSelectAllItems</method-name>
                <method-params>
                </method-params>
              </query-method>
              <result-type-mapping>Local</result-type-mapping>
              <ejb-ql>
                <!-- SELECT OBJECT(i) FROM Item AS i -->
                SELECT DISTINCT p.item FROM Store AS s, IN (s.racks) AS r, IN(r.positions) AS p
              </ejb-ql>
            </query>
            <query>
              <query-method>
                <method-name>ejbSelectPositionsForItem</method-name>
                <method-params>
                  <method-param>java.lang.Integer</method-param>
                </method-params>
              </query-method>
              <result-type-mapping>Local</result-type-mapping>
              <ejb-ql>
                <!-- SELECT OBJECT(p) FROM Position AS p WHERE p.itemId = ?1 -->
                SELECT OBJECT(p) FROM Store AS s, IN (s.racks) AS r, IN(r.positions) AS p WHERE p.itemId = ?1
              </ejb-ql>
            </query>
        </entity>
        <entity>
            <ejb-name>RackLocal</ejb-name>
            <local-home>ejb.store.rack.RackLocalHome</local-home>
            <local>ejb.store.rack.RackLocal</local>
            <ejb-class>ejb.store.rack.RackBean</ejb-class>
            <persistence-type>Container</persistence-type>
            <prim-key-class>java.lang.Integer</prim-key-class>
            <reentrant>False</reentrant>
            <cmp-version>2.x</cmp-version>
            <abstract-schema-name>Rack</abstract-schema-name>
            <cmp-field>
              <field-name>id</field-name>
            </cmp-field>
            <cmp-field>
              <field-name>description</field-name>
            </cmp-field>
            <cmp-field>
              <field-name>storeId</field-name>
            </cmp-field>
            <primkey-field>id</primkey-field>
        </entity>
        <entity>
            <ejb-name>PositionLocal</ejb-name>
            <local-home>ejb.store.rack.position.PositionLocalHome</local-home>
            <local>ejb.store.rack.position.PositionLocal</local>
            <ejb-class>ejb.store.rack.position.PositionBean</ejb-class>
            <persistence-type>Container</persistence-type>
            <prim-key-class>ejb.store.rack.position.PositionPK</prim-key-class>
            <reentrant>False</reentrant>
            <cmp-version>2.x</cmp-version>
            <abstract-schema-name>Position</abstract-schema-name>
            <cmp-field>
              <field-name>rackId</field-name>
            </cmp-field>
            <cmp-field>
              <field-name>row</field-name>
            </cmp-field>
            <cmp-field>
              <field-name>column</field-name>
            </cmp-field>
            <cmp-field>
              <field-name>itemId</field-name>
            </cmp-field>
            <cmp-field>
              <field-name>quantity</field-name>
            </cmp-field>
        </entity>
        <entity>
            <ejb-name>ItemLocal</ejb-name>
            <local-home>ejb.store.item.ItemLocalHome</local-home>
            <local>ejb.store.item.ItemLocal</local>
            <ejb-class>ejb.store.item.ItemBean</ejb-class>
            <persistence-type>Container</persistence-type>
            <prim-key-class>java.lang.Integer</prim-key-class>
            <reentrant>False</reentrant>
            <cmp-version>2.x</cmp-version>
            <abstract-schema-name>Item</abstract-schema-name>
            <cmp-field>
              <field-name>id</field-name>
            </cmp-field>
            <cmp-field>
              <field-name>description</field-name>
            </cmp-field>
            <cmp-field>
              <field-name>supplier</field-name>
            </cmp-field>
            <primkey-field>id</primkey-field>
        </entity>
    </enterprise-beans>
    <relationships>
        <ejb-relation>
            <ejb-relation-name>Store-Rack</ejb-relation-name>
            <ejb-relationship-role>
                <ejb-relationship-role-name>store-has-racks</ejb-relationship-role-name>
                <multiplicity>One</multiplicity>
                <relationship-role-source>
                    <ejb-name>Store</ejb-name>
               </relationship-role-source>
               <cmr-field>
                   <cmr-field-name>racks</cmr-field-name>
                   <cmr-field-type>java.util.Collection</cmr-field-type>
               </cmr-field>
            </ejb-relationship-role>
            <ejb-relationship-role>
                <ejb-relationship-role-name>rack-belongs-to-store</ejb-relationship-role-name>
                <multiplicity>Many</multiplicity>
                <cascade-delete/>
                <relationship-role-source>
                    <ejb-name>RackLocal</ejb-name>
               </relationship-role-source>
            </ejb-relationship-role>
        </ejb-relation>
        <ejb-relation>
            <ejb-relation-name>Rack-Position</ejb-relation-name>
            <ejb-relationship-role>
                <ejb-relationship-role-name>rack-has-positions</ejb-relationship-role-name>
                <multiplicity>One</multiplicity>
                <relationship-role-source>
                    <ejb-name>RackLocal</ejb-name>
               </relationship-role-source>
               <cmr-field>
                   <cmr-field-name>positions</cmr-field-name>
                   <cmr-field-type>java.util.Collection</cmr-field-type>
               </cmr-field>
            </ejb-relationship-role>
            <ejb-relationship-role>
                <ejb-relationship-role-name>position-belongs-to-rack</ejb-relationship-role-name>
                <multiplicity>Many</multiplicity>
                <cascade-delete/>
                <relationship-role-source>
                    <ejb-name>PositionLocal</ejb-name>
               </relationship-role-source>
               <cmr-field>
                   <cmr-field-name>rack</cmr-field-name>
               </cmr-field>
            </ejb-relationship-role>
        </ejb-relation>
        <ejb-relation>
            <ejb-relation-name>Position-Item</ejb-relation-name>
            <ejb-relationship-role>
                <ejb-relationship-role-name>position-has-item</ejb-relationship-role-name>
                <multiplicity>Many</multiplicity>
                <relationship-role-source>
                    <ejb-name>PositionLocal</ejb-name>
               </relationship-role-source>
               <cmr-field>
                   <cmr-field-name>item</cmr-field-name>
               </cmr-field>
            </ejb-relationship-role>
            <ejb-relationship-role>
                <ejb-relationship-role-name>item-is-in-position(s)</ejb-relationship-role-name>
                <multiplicity>One</multiplicity>
                <relationship-role-source>
                    <ejb-name>ItemLocal</ejb-name>
               </relationship-role-source>
            </ejb-relationship-role>
        </ejb-relation>
    </relationships>

    <assembly-descriptor>
        <!-- container-transaction>
            <method>
                <ejb-name>PositionLocal</ejb-name>
                <method-name>setItem</method-name>
            </method>
            <trans-attribute>Required</trans-attribute>
        </container-transaction -->
    </assembly-descriptor>
</ejb-jar>

